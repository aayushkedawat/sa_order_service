{
  "openapi": "3.0.0",
  "paths":
    {
      "/v1/orders/health":
        {
          "get":
            {
              "operationId": "OrdersController_health",
              "summary": "Health check",
              "parameters": [],
              "responses": { "200": { "description": "Service is healthy" } },
              "tags": ["orders"],
            },
        },
      "/v1/orders":
        {
          "get":
            {
              "operationId": "OrdersController_findAll",
              "summary": "List orders with cursor pagination",
              "parameters":
                [
                  {
                    "name": "customerId",
                    "required": false,
                    "in": "query",
                    "description": "Filter by customer ID (integer)",
                    "schema": { "type": "integer", "example": 54 },
                  },
                  {
                    "name": "restaurantId",
                    "required": false,
                    "in": "query",
                    "description": "Filter by restaurant ID (integer)",
                    "schema": { "type": "integer", "example": 36 },
                  },
                  {
                    "name": "status",
                    "required": false,
                    "in": "query",
                    "description": "Filter by order status",
                    "schema":
                      {
                        "type": "string",
                        "enum":
                          [
                            "CREATED",
                            "CONFIRMED",
                            "PREPARING",
                            "READY",
                            "DISPATCHED",
                            "DELIVERED",
                            "CANCELLED",
                          ],
                        "example": "DELIVERED",
                      },
                  },
                  {
                    "name": "limit",
                    "required": false,
                    "in": "query",
                    "description": "Number of results per page (default: 10)",
                    "schema":
                      { "type": "integer", "default": 10, "example": 10 },
                  },
                  {
                    "name": "cursor",
                    "required": false,
                    "in": "query",
                    "description": "Cursor for pagination (timestamp from previous response)",
                    "schema":
                      {
                        "type": "string",
                        "example": "2024-01-01T00:00:00.000Z",
                      },
                  },
                ],
              "responses": { "200": { "description": "List of orders" } },
              "tags": ["orders"],
            },
          "post":
            {
              "operationId": "OrdersController_create",
              "summary": "Create new order",
              "parameters":
                [
                  {
                    "name": "idempotency-key",
                    "required": true,
                    "in": "header",
                    "description": "Unique idempotency key (UUID recommended)",
                    "schema":
                      {
                        "type": "string",
                        "example": "550e8400-e29b-41d4-a716-446655440000",
                      },
                  },
                ],
              "requestBody":
                {
                  "required": true,
                  "content":
                    {
                      "application/json":
                        {
                          "schema":
                            { "$ref": "#/components/schemas/CreateOrderDto" },
                        },
                    },
                },
              "responses":
                {
                  "201": { "description": "Order created" },
                  "400": { "description": "Missing Idempotency-Key header" },
                  "409":
                    {
                      "description": "Business conflict (idempotency mismatch, total mismatch, payment failed, etc.)",
                    },
                  "422":
                    {
                      "description": "Unprocessable entity (restaurant closed, item unavailable, etc.)",
                    },
                },
              "tags": ["orders"],
            },
        },
      "/v1/orders/{orderId}":
        {
          "get":
            {
              "operationId": "OrdersController_findOne",
              "summary": "Get order by ID",
              "parameters":
                [
                  {
                    "name": "orderId",
                    "required": true,
                    "in": "path",
                    "description": "Order ID (integer)",
                    "schema": { "type": "integer", "example": 1 },
                  },
                ],
              "responses":
                {
                  "200": { "description": "Order details" },
                  "404": { "description": "Order not found" },
                },
              "tags": ["orders"],
            },
          "delete":
            {
              "operationId": "OrdersController_cancel",
              "summary": "Cancel order",
              "parameters":
                [
                  {
                    "name": "orderId",
                    "required": true,
                    "in": "path",
                    "description": "Order ID (integer)",
                    "schema": { "type": "integer", "example": 1 },
                  },
                ],
              "responses":
                {
                  "200": { "description": "Order cancelled" },
                  "404": { "description": "Order not found" },
                  "409":
                    {
                      "description": "Cannot cancel order (not in CREATED status)",
                    },
                },
              "tags": ["orders"],
            },
        },
    },
  "info":
    {
      "title": "Order Service API",
      "description": "Online Food Delivery - Order Service",
      "version": "1.0",
      "contact": {},
    },
  "tags": [],
  "servers": [],
  "components":
    {
      "securitySchemes":
        {
          "Idempotency-Key":
            { "type": "apiKey", "in": "header", "name": "Idempotency-Key" },
        },
      "schemas":
        {
          "OrderItemDto":
            {
              "type": "object",
              "properties":
                {
                  "itemId":
                    {
                      "type": "integer",
                      "description": "Menu item ID",
                      "example": 317,
                    },
                  "quantity":
                    {
                      "type": "integer",
                      "minimum": 1,
                      "maximum": 5,
                      "description": "Item quantity",
                      "example": 2,
                    },
                },
              "required": ["itemId", "quantity"],
            },
          "ClientTotalsDto":
            {
              "type": "object",
              "properties":
                {
                  "subtotal":
                    {
                      "type": "number",
                      "description": "Subtotal amount",
                      "example": 420.00,
                    },
                  "tax":
                    {
                      "type": "number",
                      "description": "Tax amount",
                      "example": 21.00,
                    },
                  "deliveryFee":
                    {
                      "type": "number",
                      "description": "Delivery fee",
                      "example": 40.00,
                    },
                  "total":
                    {
                      "type": "number",
                      "description": "Total amount",
                      "example": 481.00,
                    },
                },
              "required": ["subtotal", "tax", "deliveryFee", "total"],
            },
          "PaymentDto":
            {
              "type": "object",
              "properties":
                {
                  "method":
                    {
                      "type": "string",
                      "enum": ["COD", "CARD", "UPI", "WALLET"],
                      "description": "Payment method",
                      "example": "CARD",
                    },
                  "reference":
                    {
                      "type": "string",
                      "description": "Payment reference (optional for COD)",
                      "example": "tok_123",
                    },
                },
              "required": ["method"],
            },
          "CreateOrderDto":
            {
              "type": "object",
              "properties":
                {
                  "customerId":
                    {
                      "type": "integer",
                      "description": "Customer ID",
                      "example": 1,
                    },
                  "restaurantId":
                    {
                      "type": "integer",
                      "description": "Restaurant ID",
                      "example": 36,
                    },
                  "addressId":
                    {
                      "type": "integer",
                      "description": "Delivery address ID",
                      "example": 73,
                    },
                  "items":
                    {
                      "type": "array",
                      "maxItems": 20,
                      "description": "Order items (max 20)",
                      "items": { "$ref": "#/components/schemas/OrderItemDto" },
                    },
                  "clientTotals":
                    { "$ref": "#/components/schemas/ClientTotalsDto" },
                  "payment": { "$ref": "#/components/schemas/PaymentDto" },
                  "note":
                    {
                      "type": "string",
                      "description": "Optional order note",
                      "example": "Extra spicy",
                    },
                },
              "required":
                [
                  "customerId",
                  "restaurantId",
                  "addressId",
                  "items",
                  "clientTotals",
                  "payment",
                ],
            },
        },
    },
}
